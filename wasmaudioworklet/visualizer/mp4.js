var Cn=(()=>{var h=import.meta.url;return function(t){t=t||{};var t=typeof t!="undefined"?t:{},u=Object.assign,_,b;t.ready=new Promise(function(n,r){_=n,b=r}),t.create_buffer=function(r){return t._malloc(r)},t.free_buffer=function(r){return t._free(r)},t.locateFile=function(r,e){return t.simd&&(r=r.replace(/\.wasm$/i,".simd.wasm")),t.getWasmPath?t.getWasmPath(r,e,t.simd):e+r},t.createWebCodecsEncoder=function(r){return Jn(t,r)};var v=u({},t),g=[],B="./this.program",N=(n,r)=>{throw r},q=typeof window=="object",x=typeof importScripts=="function",nn=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function k(n){return t.locateFile?t.locateFile(n,y):y+n}var X,an,G,on;(q||x)&&(x?y=self.location.href:typeof document!="undefined"&&document.currentScript&&(y=document.currentScript.src),h&&(y=h),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",X=function(n){var r=new XMLHttpRequest;return r.open("GET",n,!1),r.send(null),r.responseText},x&&(G=function(n){var r=new XMLHttpRequest;return r.open("GET",n,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),an=function(n,r,e){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status==200||i.status==0&&i.response){r(i.response);return}e()},i.onerror=e,i.send(null)},on=n=>document.title=n);var Wn=t.print||console.log.bind(console),O=t.printErr||console.warn.bind(console);u(t,v),v=null,t.arguments&&(g=t.arguments),t.thisProgram&&(B=t.thisProgram),t.quit&&(N=t.quit);var U;t.wasmBinary&&(U=t.wasmBinary);var Sn=t.noExitRuntime||!0;typeof WebAssembly!="object"&&en("no native wasm support detected");var Z,fn=!1,A;function m(n,r,e){for(var i=r+e,a="";!(r>=i);){var f=n[r++];if(!f)return a;if(!(f&128)){a+=String.fromCharCode(f);continue}var c=n[r++]&63;if((f&224)==192){a+=String.fromCharCode((f&31)<<6|c);continue}var o=n[r++]&63;if((f&240)==224?f=(f&15)<<12|c<<6|o:f=(f&7)<<18|c<<12|o<<6|n[r++]&63,f<65536)a+=String.fromCharCode(f);else{var s=f-65536;a+=String.fromCharCode(55296|s>>10,56320|s&1023)}}return a}function T(n,r){return n?m(P,n,r):""}function R(n,r,e,i){if(!(i>0))return 0;for(var a=e,f=e+i-1,c=0;c<n.length;++c){var o=n.charCodeAt(c);if(o>=55296&&o<=57343){var s=n.charCodeAt(++c);o=65536+((o&1023)<<10)|s&1023}if(o<=127){if(e>=f)break;r[e++]=o}else if(o<=2047){if(e+1>=f)break;r[e++]=192|o>>6,r[e++]=128|o&63}else if(o<=65535){if(e+2>=f)break;r[e++]=224|o>>12,r[e++]=128|o>>6&63,r[e++]=128|o&63}else{if(e+3>=f)break;r[e++]=240|o>>18,r[e++]=128|o>>12&63,r[e++]=128|o>>6&63,r[e++]=128|o&63}}return r[e]=0,e-a}function V(n,r,e){return R(n,P,r,e)}function E(n){for(var r=0,e=0;e<n.length;++e){var i=n.charCodeAt(e);i>=55296&&i<=57343&&(i=65536+((i&1023)<<10)|n.charCodeAt(++e)&1023),i<=127?++r:i<=2047?r+=2:i<=65535?r+=3:r+=4}return r}function vn(n,r){for(var e="",i=0;!(i>=r/2);++i){var a=J[n+i*2>>1];if(a==0)break;e+=String.fromCharCode(a)}return e}function Qn(n,r,e){if(e===void 0&&(e=2147483647),e<2)return 0;e-=2;for(var i=r,a=e<n.length*2?e/2:n.length,f=0;f<a;++f){var c=n.charCodeAt(f);J[r>>1]=c,r+=2}return J[r>>1]=0,r-i}function Mn(n){return n.length*2}function nr(n,r){for(var e=0,i="";!(e>=r/4);){var a=H[n+e*4>>2];if(a==0)break;if(++e,a>=65536){var f=a-65536;i+=String.fromCharCode(55296|f>>10,56320|f&1023)}else i+=String.fromCharCode(a)}return i}function rr(n,r,e){if(e===void 0&&(e=2147483647),e<4)return 0;for(var i=r,a=i+e-4,f=0;f<n.length;++f){var c=n.charCodeAt(f);if(c>=55296&&c<=57343){var o=n.charCodeAt(++f);c=65536+((c&1023)<<10)|o&1023}if(H[r>>2]=c,r+=4,r+4>a)break}return H[r>>2]=0,r-i}function er(n){for(var r=0,e=0;e<n.length;++e){var i=n.charCodeAt(e);i>=55296&&i<=57343&&++e,r+=4}return r}function tr(n,r){return n%r>0&&(n+=r-n%r),n}var pn,gn,P,J,hn,H,D,kn,In;function On(n){pn=n,t.HEAP8=gn=new Int8Array(n),t.HEAP16=J=new Int16Array(n),t.HEAP32=H=new Int32Array(n),t.HEAPU8=P=new Uint8Array(n),t.HEAPU16=hn=new Uint16Array(n),t.HEAPU32=D=new Uint32Array(n),t.HEAPF32=kn=new Float32Array(n),t.HEAPF64=In=new Float64Array(n)}var ye=t.INITIAL_MEMORY||16777216,Vn,Hn=[],Dn=[],Ln=[],ir=!1;function ar(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)sr(t.preRun.shift());dn(Hn)}function or(){ir=!0,dn(Dn)}function fr(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)ur(t.postRun.shift());dn(Ln)}function sr(n){Hn.unshift(n)}function cr(n){Dn.unshift(n)}function ur(n){Ln.unshift(n)}var Y=0,_n=null,rn=null;function lr(n){Y++,t.monitorRunDependencies&&t.monitorRunDependencies(Y)}function vr(n){if(Y--,t.monitorRunDependencies&&t.monitorRunDependencies(Y),Y==0&&(_n!==null&&(clearInterval(_n),_n=null),rn)){var r=rn;rn=null,r()}}t.preloadedImages={},t.preloadedAudios={};function en(n){t.onAbort&&t.onAbort(n),n="Aborted("+n+")",O(n),fn=!0,A=1,n+=". Build with -s ASSERTIONS=1 for more info.";var r=new WebAssembly.RuntimeError(n);throw b(r),r}var pr="data:application/octet-stream;base64,";function jn(n){return n.startsWith(pr)}var W;t.locateFile?(W="mp4.wasm",jn(W)||(W=k(W))):W=new URL("mp4.wasm",import.meta.url).toString();function Bn(n){try{if(n==W&&U)return new Uint8Array(U);if(G)return G(n);throw"both async and sync fetching of the wasm failed"}catch(r){en(r)}}function gr(){return!U&&(q||x)&&typeof fetch=="function"?fetch(W,{credentials:"same-origin"}).then(function(n){if(!n.ok)throw"failed to load wasm binary file at '"+W+"'";return n.arrayBuffer()}).catch(function(){return Bn(W)}):Promise.resolve().then(function(){return Bn(W)})}function hr(){var n={a:se};function r(c,o){var s=c.exports;t.asm=s,Z=t.asm.x,On(Z.buffer),Vn=t.asm.B,cr(t.asm.y),vr("wasm-instantiate")}lr("wasm-instantiate");function e(c){r(c.instance)}function i(c){return gr().then(function(o){return WebAssembly.instantiate(o,n)}).then(function(o){return o}).then(c,function(o){O("failed to asynchronously prepare wasm: "+o),en(o)})}function a(){return!U&&typeof WebAssembly.instantiateStreaming=="function"&&!jn(W)&&typeof fetch=="function"?fetch(W,{credentials:"same-origin"}).then(function(c){var o=WebAssembly.instantiateStreaming(c,n);return o.then(e,function(s){return O("wasm streaming compile failed: "+s),O("falling back to ArrayBuffer instantiation"),i(e)})}):i(e)}if(t.instantiateWasm)try{var f=t.instantiateWasm(n,r);return f}catch(c){return O("Module.instantiateWasm callback failed with error: "+c),!1}return a().catch(b),{}}function dn(n){for(;n.length>0;){var r=n.shift();if(typeof r=="function"){r(t);continue}var e=r.func;typeof e=="number"?r.arg===void 0?cn(e)():cn(e)(r.arg):e(r.arg===void 0?null:r.arg)}}var sn=[];function cn(n){var r=sn[n];return r||(n>=sn.length&&(sn.length=n+1),sn[n]=r=Vn.get(n)),r}function _r(n,r,e,i){en("Assertion failed: "+T(n)+", at: "+[r?T(r):"unknown filename",e,i?T(i):"unknown function"])}function dr(n,r,e,i,a){}function yn(n){switch(n){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+n)}}function yr(){for(var n=new Array(256),r=0;r<256;++r)n[r]=String.fromCharCode(r);Nn=n}var Nn=void 0;function S(n){for(var r="",e=n;P[e];)r+=Nn[P[e++]];return r}var Q={},$={},un={},mr=48,wr=57;function qn(n){if(n===void 0)return"_unknown";n=n.replace(/[^a-zA-Z0-9_]/g,"$");var r=n.charCodeAt(0);return r>=mr&&r<=wr?"_"+n:n}function xn(n,r){return n=qn(n),new Function("body","return function "+n+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(r)}function mn(n,r){var e=xn(r,function(i){this.name=r,this.message=i;var a=new Error(i).stack;a!==void 0&&(this.stack=this.toString()+`
`+a.replace(/^Error(:[^\n]*)?\n/,""))});return e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},e}var zn=void 0;function F(n){throw new zn(n)}var Xn=void 0;function Gn(n){throw new Xn(n)}function br(n,r,e){n.forEach(function(o){un[o]=r});function i(o){var s=e(o);s.length!==n.length&&Gn("Mismatched type converter count");for(var l=0;l<n.length;++l)L(n[l],s[l])}var a=new Array(r.length),f=[],c=0;r.forEach(function(o,s){$.hasOwnProperty(o)?a[s]=$[o]:(f.push(o),Q.hasOwnProperty(o)||(Q[o]=[]),Q[o].push(function(){a[s]=$[o],++c,c===f.length&&i(a)}))}),f.length===0&&i(a)}function L(n,r,e){if(e=e||{},!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=r.name;if(n||F('type "'+i+'" must have a positive integer typeid pointer'),$.hasOwnProperty(n)){if(e.ignoreDuplicateRegistrations)return;F("Cannot register type '"+i+"' twice")}if($[n]=r,delete un[n],Q.hasOwnProperty(n)){var a=Q[n];delete Q[n],a.forEach(function(f){f()})}}function Ar(n,r,e,i,a){var f=yn(e);r=S(r),L(n,{name:r,fromWireType:function(c){return!!c},toWireType:function(c,o){return o?i:a},argPackAdvance:8,readValueFromPointer:function(c){var o;if(e===1)o=gn;else if(e===2)o=J;else if(e===4)o=H;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(o[c>>f])},destructorFunction:null})}var wn=[],I=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function bn(n){n>4&&--I[n].refcount==0&&(I[n]=void 0,wn.push(n))}function Er(){for(var n=0,r=5;r<I.length;++r)I[r]!==void 0&&++n;return n}function Tr(){for(var n=5;n<I.length;++n)if(I[n]!==void 0)return I[n];return null}function Fr(){t.count_emval_handles=Er,t.get_first_emval=Tr}var C={toValue:function(n){return n||F("Cannot use deleted val. handle = "+n),I[n].value},toHandle:function(n){switch(n){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var r=wn.length?wn.pop():I.length;return I[r]={refcount:1,value:n},r}}}};function An(n){return this.fromWireType(D[n>>2])}function Cr(n,r){r=S(r),L(n,{name:r,fromWireType:function(e){var i=C.toValue(e);return bn(e),i},toWireType:function(e,i){return C.toHandle(i)},argPackAdvance:8,readValueFromPointer:An,destructorFunction:null})}function Ur(n,r){switch(r){case 2:return function(e){return this.fromWireType(kn[e>>2])};case 3:return function(e){return this.fromWireType(In[e>>3])};default:throw new TypeError("Unknown float type: "+n)}}function Rr(n,r,e){var i=yn(e);r=S(r),L(n,{name:r,fromWireType:function(a){return a},toWireType:function(a,f){return f},argPackAdvance:8,readValueFromPointer:Ur(r,i),destructorFunction:null})}function Pr(n,r){if(!(n instanceof Function))throw new TypeError("new_ called with constructor type "+typeof n+" which is not a function");var e=xn(n.name||"unknownFunctionName",function(){});e.prototype=n.prototype;var i=new e,a=n.apply(i,r);return a instanceof Object?a:i}function Yn(n){for(;n.length;){var r=n.pop(),e=n.pop();e(r)}}function Wr(n,r,e,i,a){var f=r.length;f<2&&F("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var c=r[1]!==null&&e!==null,o=!1,s=1;s<r.length;++s)if(r[s]!==null&&r[s].destructorFunction===void 0){o=!0;break}for(var l=r[0].name!=="void",w="",p="",s=0;s<f-2;++s)w+=(s!==0?", ":"")+"arg"+s,p+=(s!==0?", ":"")+"arg"+s+"Wired";var d="return function "+qn(n)+"("+w+`) {
if (arguments.length !== `+(f-2)+`) {
throwBindingError('function `+n+" called with ' + arguments.length + ' arguments, expected "+(f-2)+` args!');
}
`;o&&(d+=`var destructors = [];
`);var K=o?"destructors":"null",z=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],tn=[F,i,a,Yn,r[0],r[1]];c&&(d+="var thisWired = classParam.toWireType("+K+`, this);
`);for(var s=0;s<f-2;++s)d+="var arg"+s+"Wired = argType"+s+".toWireType("+K+", arg"+s+"); // "+r[s+2].name+`
`,z.push("argType"+s),tn.push(r[s+2]);if(c&&(p="thisWired"+(p.length>0?", ":"")+p),d+=(l?"var rv = ":"")+"invoker(fn"+(p.length>0?", ":"")+p+`);
`,o)d+=`runDestructors(destructors);
`;else for(var s=c?1:2;s<r.length;++s){var M=s===1?"thisWired":"arg"+(s-2)+"Wired";r[s].destructorFunction!==null&&(d+=M+"_dtor("+M+"); // "+r[s].name+`
`,z.push(M+"_dtor"),tn.push(r[s].destructorFunction))}l&&(d+=`var ret = retType.fromWireType(rv);
return ret;
`),d+=`}
`,z.push(d);var ve=Pr(Function,z).apply(null,tn);return ve}function Sr(n,r,e){if(n[r].overloadTable===void 0){var i=n[r];n[r]=function(){return n[r].overloadTable.hasOwnProperty(arguments.length)||F("Function '"+e+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+n[r].overloadTable+")!"),n[r].overloadTable[arguments.length].apply(this,arguments)},n[r].overloadTable=[],n[r].overloadTable[i.argCount]=i}}function kr(n,r,e){t.hasOwnProperty(n)?((e===void 0||t[n].overloadTable!==void 0&&t[n].overloadTable[e]!==void 0)&&F("Cannot register public name '"+n+"' twice"),Sr(t,n,n),t.hasOwnProperty(e)&&F("Cannot register multiple overloads of a function with the same number of arguments ("+e+")!"),t[n].overloadTable[e]=r):(t[n]=r,e!==void 0&&(t[n].numArguments=e))}function Ir(n,r){for(var e=[],i=0;i<n;i++)e.push(H[(r>>2)+i]);return e}function Or(n,r,e){t.hasOwnProperty(n)||Gn("Replacing nonexistant public symbol"),t[n].overloadTable!==void 0&&e!==void 0?t[n].overloadTable[e]=r:(t[n]=r,t[n].argCount=e)}function Vr(n,r,e){var i=t["dynCall_"+n];return e&&e.length?i.apply(null,[r].concat(e)):i.call(null,r)}function Hr(n,r,e){return n.includes("j")?Vr(n,r,e):cn(r).apply(null,e)}function Dr(n,r){var e=[];return function(){e.length=arguments.length;for(var i=0;i<arguments.length;i++)e[i]=arguments[i];return Hr(n,r,e)}}function Lr(n,r){n=S(n);function e(){return n.includes("j")?Dr(n,r):cn(r)}var i=e();return typeof i!="function"&&F("unknown function pointer with signature "+n+": "+r),i}var $n=void 0;function Kn(n){var r=Zn(n),e=S(r);return j(r),e}function jr(n,r){var e=[],i={};function a(f){if(!i[f]&&!$[f]){if(un[f]){un[f].forEach(a);return}e.push(f),i[f]=!0}}throw r.forEach(a),new $n(n+": "+e.map(Kn).join([", "]))}function Br(n,r,e,i,a,f){var c=Ir(r,e);n=S(n),a=Lr(i,a),kr(n,function(){jr("Cannot call "+n+" due to unbound types",c)},r-1),br([],c,function(o){var s=[o[0],null].concat(o.slice(1));return Or(n,Wr(n,s,null,a,f),r-1),[]})}function Nr(n,r,e){switch(r){case 0:return e?function(a){return gn[a]}:function(a){return P[a]};case 1:return e?function(a){return J[a>>1]}:function(a){return hn[a>>1]};case 2:return e?function(a){return H[a>>2]}:function(a){return D[a>>2]};default:throw new TypeError("Unknown integer type: "+n)}}function qr(n,r,e,i,a){r=S(r),a===-1&&(a=4294967295);var f=yn(e),c=function(p){return p};if(i===0){var o=32-8*e;c=function(p){return p<<o>>>o}}var s=r.includes("unsigned"),l=function(p,d){},w;s?w=function(p,d){return l(d,this.name),d>>>0}:w=function(p,d){return l(d,this.name),d},L(n,{name:r,fromWireType:c,toWireType:w,argPackAdvance:8,readValueFromPointer:Nr(r,f,i!==0),destructorFunction:null})}function xr(n,r,e){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],a=i[r];function f(c){c=c>>2;var o=D,s=o[c],l=o[c+1];return new a(pn,l,s)}e=S(e),L(n,{name:e,fromWireType:f,argPackAdvance:8,readValueFromPointer:f},{ignoreDuplicateRegistrations:!0})}function zr(n,r){r=S(r);var e=r==="std::string";L(n,{name:r,fromWireType:function(i){var a=D[i>>2],f;if(e)for(var c=i+4,o=0;o<=a;++o){var s=i+4+o;if(o==a||P[s]==0){var l=s-c,w=T(c,l);f===void 0?f=w:(f+=String.fromCharCode(0),f+=w),c=s+1}}else{for(var p=new Array(a),o=0;o<a;++o)p[o]=String.fromCharCode(P[i+4+o]);f=p.join("")}return j(i),f},toWireType:function(i,a){a instanceof ArrayBuffer&&(a=new Uint8Array(a));var f,c=typeof a=="string";c||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Int8Array||F("Cannot pass non-string to std::string"),e&&c?f=function(){return E(a)}:f=function(){return a.length};var o=f(),s=Tn(4+o+1);if(D[s>>2]=o,e&&c)V(a,s+4,o+1);else if(c)for(var l=0;l<o;++l){var w=a.charCodeAt(l);w>255&&(j(s),F("String has UTF-16 code units that do not fit in 8 bits")),P[s+4+l]=w}else for(var l=0;l<o;++l)P[s+4+l]=a[l];return i!==null&&i.push(j,s),s},argPackAdvance:8,readValueFromPointer:An,destructorFunction:function(i){j(i)}})}function Xr(n,r,e){e=S(e);var i,a,f,c,o;r===2?(i=vn,a=Qn,c=Mn,f=function(){return hn},o=1):r===4&&(i=nr,a=rr,c=er,f=function(){return D},o=2),L(n,{name:e,fromWireType:function(s){for(var l=D[s>>2],w=f(),p,d=s+4,K=0;K<=l;++K){var z=s+4+K*r;if(K==l||w[z>>o]==0){var tn=z-d,M=i(d,tn);p===void 0?p=M:(p+=String.fromCharCode(0),p+=M),d=z+r}}return j(s),p},toWireType:function(s,l){typeof l!="string"&&F("Cannot pass non-string to C++ string type "+e);var w=c(l),p=Tn(4+w+r);return D[p>>2]=w>>o,a(l,p+4,w+r),s!==null&&s.push(j,p),p},argPackAdvance:8,readValueFromPointer:An,destructorFunction:function(s){j(s)}})}function Gr(n,r){r=S(r),L(n,{isVoid:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(e,i){}})}function En(n,r){var e=$[n];return e===void 0&&F(r+" has unknown type "+Kn(n)),e}function Yr(n,r,e){n=C.toValue(n),r=En(r,"emval::as");var i=[],a=C.toHandle(i);return H[e>>2]=a,r.toWireType(i,n)}function $r(n,r){for(var e=new Array(n),i=0;i<n;++i)e[i]=En(H[(r>>2)+i],"parameter "+i);return e}function Kr(n,r,e,i){n=C.toValue(n);for(var a=$r(r,e),f=new Array(r),c=0;c<r;++c){var o=a[c];f[c]=o.readValueFromPointer(i),i+=o.argPackAdvance}var s=n.apply(void 0,f);return C.toHandle(s)}function Zr(n,r){return n=C.toValue(n),r=C.toValue(r),C.toHandle(n[r])}function Jr(n){n>4&&(I[n].refcount+=1)}function Qr(n){return n=C.toValue(n),typeof n=="number"}var Mr={};function ne(n){var r=Mr[n];return r===void 0?S(n):r}function re(n){return C.toHandle(ne(n))}function ee(n){var r=C.toValue(n);Yn(r),bn(n)}function te(n,r){n=En(n,"_emval_take_value");var e=n.readValueFromPointer(r);return C.toHandle(e)}function ie(){en("")}function ae(n,r,e){P.copyWithin(n,r,r+e)}function oe(n){try{return Z.grow(n-pn.byteLength+65535>>>16),On(Z.buffer),1}catch(r){}}function fe(n){var r=P.length;n=n>>>0;var e=2147483648;if(n>e)return!1;for(var i=1;i<=4;i*=2){var a=r*(1+.2/i);a=Math.min(a,n+100663296);var f=Math.min(e,tr(Math.max(n,a),65536)),c=oe(f);if(c)return!0}return!1}yr(),zn=t.BindingError=mn(Error,"BindingError"),Xn=t.InternalError=mn(Error,"InternalError"),Fr(),$n=t.UnboundTypeError=mn(Error,"UnboundTypeError");var se={a:_r,q:dr,u:Ar,t:Cr,n:Rr,k:Br,d:qr,c:xr,m:zr,l:Xr,v:Gr,j:Yr,w:Kr,b:bn,e:Zr,g:Jr,p:Qr,f:re,i:ee,h:te,o:ie,r:ae,s:fe},me=hr(),ce=t.___wasm_call_ctors=function(){return(ce=t.___wasm_call_ctors=t.asm.y).apply(null,arguments)},Tn=t._malloc=function(){return(Tn=t._malloc=t.asm.z).apply(null,arguments)},j=t._free=function(){return(j=t._free=t.asm.A).apply(null,arguments)},Zn=t.___getTypeName=function(){return(Zn=t.___getTypeName=t.asm.C).apply(null,arguments)},ue=t.___embind_register_native_and_builtin_types=function(){return(ue=t.___embind_register_native_and_builtin_types=t.asm.D).apply(null,arguments)},le=t.dynCall_ijiii=function(){return(le=t.dynCall_ijiii=t.asm.E).apply(null,arguments)},ln;rn=function n(){ln||Fn(),ln||(rn=n)};function Fn(n){if(n=n||g,Y>0||(ar(),Y>0))return;function r(){ln||(ln=!0,t.calledRun=!0,!fn&&(or(),_(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),fr()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),r()},1)):r()}if(t.run=Fn,t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return Fn(),t.ready}})(),pe=Cn,Un=new Uint8Array([0,0,0,1]);function ge(h){console.error(h)}Cn.createFile=Rn;function Rn(h=256){let t=0,u=0,_=new Uint8Array(h);return{contents:function(){return _.slice(0,u)},seek:function(v){t=v},write:function(v){let g=v.byteLength;return b(t+g),_.set(v,t),t+=g,u=Math.max(u,t),g}};function b(v){var g=_.length;if(g>=v)return;var B=1024*1024;v=Math.max(v,g*(g<B?2:1.125)>>>0),g!=0&&(v=Math.max(v,256));let N=_;_=new Uint8Array(v),u>0&&_.set(N.subarray(0,u),0)}}Cn.isWebCodecsSupported=Pn;function Pn(){return typeof window!="undefined"&&typeof window.VideoEncoder=="function"}function Jn(h,t={}){let{width:u,height:_,groupOfPictures:b=20,fps:v=30,fragmentation:g=!1,sequential:B=!1,hevc:N=!1,format:q="annexb",codec:x="avc1.4d0034",acceleration:nn,bitrate:y,error:k=ge,encoderOptions:X={},flushFrequency:an=10}=t;if(!Pn())throw new Error("MP4 H264 encoding/decoding depends on WebCodecs API which is not supported in this environment");if(typeof u!="number"||typeof _!="number")throw new Error("Must specify { width, height } options");if(!isFinite(u)||u<0||!isFinite(_)||_<0)throw new Error("{ width, height } options must be positive integers");let G=Rn(),on=h.create_muxer({width:u,height:_,fps:v,fragmentation:g,sequential:B,hevc:N},Sn),Wn={codec:x,width:u,height:_,avc:{format:q},hardwareAcceleration:nn,bitrate:y,...X},O=0,U=new window.VideoEncoder({output(A,m){fn(A,m)},error:k});return U.configure(Wn),{async end(){return await U.flush(),U.close(),h.finalize_muxer(on),G.contents()},async addFrame(A){let m=1/v*O*1e6,T=O%b==0,R=new VideoFrame(A,{timestamp:m});U.encode(R,{keyFrame:T}),R.close(),an!=null&&(O+1)%an==0&&await U.flush(),O++},async flush(){return U.flush()}};function Sn(A,m,T){G.seek(T);let R=h.HEAPU8.subarray(A,A+m);return G.write(R)!==R.byteLength}function Z(A){let m=h._malloc(A.byteLength);h.HEAPU8.set(A,m),h.mux_nal(on,m,A.byteLength),h._free(m)}function fn(A,m){let T=null,R;if(m&&(m.description&&(R=m.description),m.decoderConfig&&m.decoderConfig.description&&(R=m.decoderConfig.description)),R)try{T=de(R)}catch(E){k(E);return}let V=[];if(T&&(T.sps_list.forEach(E=>{V.push(Un),V.push(E)}),T.pps_list.forEach(E=>{V.push(Un),V.push(E)})),q==="annexb"){let E=new Uint8Array(A.byteLength);A.copyTo(E),V.push(E)}else try{let E=new ArrayBuffer(A.byteLength);A.copyTo(E),_e(E).forEach(vn=>{V.push(Un),V.push(vn)})}catch(E){k(E);return}Z(he(V))}}function he(h){let t=h.reduce((b,v)=>b+v.byteLength,0),u=new Uint8Array(t),_=0;for(let b=0;b<h.length;b++){let v=h[b];u.set(v,_),_+=v.byteLength}return u}function _e(h){let t=4,u=0,_=[],b=h.byteLength,v=new Uint8Array(h);for(;u+t<b;){let g=v[u];if(g=(g<<8)+v[u+1],g=(g<<8)+v[u+2],g=(g<<8)+v[u+3],_.push(new Uint8Array(h,u+t,g)),g==0)throw new Error("Error: invalid nal_length 0");u+=t+g}return _}function de(h){let t=new DataView(h),u=0,_=t.getUint8(u++),b=t.getUint8(u++),v=t.getUint8(u++),g=t.getUint8(u++),B=(t.getUint8(u++)&3)+1;if(B!==4)throw new Error("Expected length_size to indicate 4 bytes");let N=t.getUint8(u++)&31,q=[];for(let y=0;y<N;y++){let k=t.getUint16(u,!1);u+=2;let X=new Uint8Array(t.buffer,u,k);q.push(X),u+=k}let x=t.getUint8(u++),nn=[];for(let y=0;y<x;y++){let k=t.getUint16(u,!1);u+=2;let X=new Uint8Array(t.buffer,u,k);nn.push(X),u+=k}return{offset:u,version:_,profile:b,compat:v,level:g,length_size:B,pps_list:nn,sps_list:q,numSPS:N}}export{Rn as createFile,Jn as createWebCodecsEncoderWithModule,pe as default,Pn as isWebCodecsSupported};
//# sourceMappingURL=mp4.js.map
